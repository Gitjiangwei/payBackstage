<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.hero.renche.mapper.TaskInfoMapper">


    <select id="qryTaskInfoList" resultType="org.hero.renche.entity.vo.TaskInfoVo">
		select task_id as taskId,prj_item_id as prjItemId,prj_item_name as prjItemName,task_name as taskName,task_content as taskContent,
			receive_user as receiveUser,plan_start_time as planStartTime,plan_end_time as planEndTime,start_time as startTime,
			end_time as endTime,contact_person as contactPerson,contact_tel as contactTel,status,t.file_rel_id as fileRelId,
			create_user as createUser,t.create_time as createTime,
			length(t.file_rel_id)-length(replace(t.file_rel_id,',','')) as fileCount
		from tx_task_info t
	<trim prefix="where" prefixOverrides="and">
        <if test="TaskInfo.prjItemName !=null and TaskInfo.prjItemName != '' ">
            and  prj_item_name like CONCAT('%',#{TaskInfo.prjItemName},'%')
        </if>
        <if test="TaskInfo.taskName !=null and TaskInfo.taskName != '' "  >
            and task_name like CONCAT('%',#{TaskInfo.taskName},'%')
        </if>
		<if test="TaskInfo.createWay !=null and TaskInfo.createWay != '' "  >
			and t.create_way = #{TaskInfo.createWay}
		</if>
		<if test="TaskInfo.createUser !=null and TaskInfo.createUser != '' "  >
			and t.create_user = #{TaskInfo.createUser}
		</if>
    </trim>
		order by t.create_time desc

    </select>

	<select id="qryFileIdByTaskId" resultType="java.lang.String">
		select  ifnull(file_rel_id,'') as fileRelId from tx_task_info where task_id = #{taskId}
	</select>

	<update id="updateFileIds">
		 update tx_task_info set file_rel_id = #{TaskInfo.fileRelId} where task_id = #{TaskInfo.taskId}
	</update>

</mapper>